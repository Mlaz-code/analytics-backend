# Drift Monitoring Dashboard

Interactive web dashboard for monitoring ML data drift and model performance in the Pikkit ML pipeline.

## Features

- **Real-time Drift Metrics** - Live visualization of data drift scores across all features
- **Feature-level Analysis** - Detailed breakdown of drift by feature with PSI/KS test statistics
- **Severity Classification** - Automatic categorization of drift severity (low/moderate/high)
- **Retraining Recommendations** - Intelligent alerts when model retraining is required
- **Historical Tracking** - View drift trends over time with auto-refresh
- **Beautiful UI** - Modern, responsive design with Chart.js visualizations

## Access

### Local Development

```bash
# Access dashboard
http://localhost:8001/drift-dashboard

# Access JSON API endpoint
http://localhost:8001/api/v1/drift-report
```

### Production (Blue-Green Deployment)

```bash
# Blue instance
http://localhost:8001/drift-dashboard

# Green instance
http://localhost:8002/drift-dashboard

# Canary instance
http://localhost:8003/drift-dashboard
```

## Screenshot

The dashboard displays:

1. **Summary Stats** - Total features checked, features drifted, severity score, retraining status
2. **Drift Scores Chart** - Bar chart showing drift scores per feature with color-coded severity
3. **Category Distribution** - Donut chart breaking down features by drift severity
4. **Detailed Table** - Sortable table with feature name, method, drift score, severity, status, and details

## API Endpoints

### GET /drift-dashboard

Serves the interactive HTML dashboard.

**Response:** HTML page with embedded JavaScript

### GET /api/v1/drift-report

Returns the most recent drift detection report in JSON format.

**Query Parameters:**
- `days_lookback` (int, default: 7) - Days of recent data to analyze
- `min_samples` (int, default: 100) - Minimum samples required

**Response:**
```json
{
  "timestamp": "2025-12-24T13:43:17.164222",
  "total_features_checked": 8,
  "features_with_drift": 6,
  "drifted_features": ["sport", "league", "market", ...],
  "requires_retraining": true,
  "report_file": "drift_report_20251224_134317.json",
  "report_age_hours": 0.5,
  "feature_details": {
    "sport": {
      "drift_score": 4.996687,
      "is_drifted": true,
      "method": "PSI",
      "severity": "high",
      ...
    },
    ...
  }
}
```

## Integration with Pikkit Dashboard

### Option 1: Embed in Netlify Dashboard (iframe)

Add to your Netlify dashboard:

```html
<iframe
  src="http://192.168.4.80:8001/drift-dashboard"
  width="100%"
  height="800px"
  frameborder="0">
</iframe>
```

### Option 2: Consume API Data

Fetch drift data from your React/Vue dashboard:

```javascript
// Fetch drift data
const response = await fetch('http://192.168.4.80:8001/api/v1/drift-report');
const driftData = await response.json();

// Use driftData in your dashboard components
console.log(`Drift detected in ${driftData.features_with_drift} features`);
```

### Option 3: Link from Dashboard

Add a navigation link:

```html
<a href="http://192.168.4.80:8001/drift-dashboard" target="_blank">
  ML Drift Monitor
</a>
```

## Deployment

### Rebuild Docker Image

After adding the dashboard, rebuild the ML API image:

```bash
cd /root/pikkit/mlops
docker-compose build pikkit-ml-api-blue
docker-compose up -d pikkit-ml-api-blue
```

### Full Blue-Green Deployment

Deploy to both instances:

```bash
cd /root/pikkit/mlops
./scripts/deploy.sh deploy
```

### Verify Dashboard

```bash
# Check dashboard loads
curl -I http://localhost:8001/drift-dashboard

# Check API endpoint
curl http://localhost:8001/api/v1/drift-report | jq .
```

## Data Requirements

The dashboard requires:

1. **Baseline Reference Data** - Created with `create_baseline_reference.py`
2. **Drift Reports** - Generated by `check_drift_and_retrain.py` (runs daily at 2 AM via cron)

If no drift reports exist, the dashboard will show instructions for generating them.

## Auto-Refresh

The dashboard automatically refreshes every 5 minutes to show the latest drift data. Click the "ğŸ”„ Refresh" button for manual updates.

## Customization

### Update Refresh Interval

Edit `/root/pikkit/mlops/app/templates/drift_dashboard.html`:

```javascript
// Change from 5 minutes to 10 minutes
setInterval(loadDashboard, 10 * 60 * 1000);
```

### Modify Chart Colors

Update the `renderDriftScoresChart` function:

```javascript
const colors = Object.values(featureDetails).map(f => {
  if (!f.is_drifted) return '#48bb78';  // Green
  const severity = f.details?.severity || 'none';
  if (severity === 'high') return '#f56565';      // Red
  if (severity === 'moderate') return '#ed8936';  // Orange
  return '#ecc94b';  // Yellow
});
```

## Troubleshooting

### Dashboard shows "No drift reports found"

Run drift detection manually:

```bash
cd /root/pikkit/ml
python3 scripts/check_drift_and_retrain.py
```

### Dashboard won't load

Check ML API logs:

```bash
docker-compose logs -f pikkit-ml-api-blue
```

Verify templates directory exists:

```bash
ls -l /root/pikkit/mlops/app/templates/
```

### API returns 500 error

Check that drift reports directory exists:

```bash
ls -l /root/pikkit/ml/reports/drift_reports/
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Drift Monitoring Dashboard             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Browser    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  FastAPI API    â”‚   â”‚
â”‚  â”‚  (Dashboard) â”‚        â”‚  /drift-report  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                         â”‚             â”‚
â”‚         â”‚                         â–¼             â”‚
â”‚         â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚         â”‚                â”‚  JSON Reports   â”‚   â”‚
â”‚         â”‚                â”‚  (filesystem)   â”‚   â”‚
â”‚         â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                         â–²             â”‚
â”‚         â–¼                         â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Chart.js    â”‚        â”‚  Drift Detector â”‚   â”‚
â”‚  â”‚  Rendering   â”‚        â”‚  (cron daily)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security

- Dashboard served via authenticated FastAPI routes
- No sensitive data exposed in frontend
- JSON reports stored server-side only
- Access controlled via network firewall rules

## Future Enhancements

- Historical drift trend visualization
- Email/Slack notifications on critical drift
- Feature importance overlay
- Model performance correlation
- Custom drift thresholds per feature
- Export reports as PDF/CSV
- Multi-model drift comparison
